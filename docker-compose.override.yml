# =============================================================================
# Docker Compose - Development Overrides
# =============================================================================
# This file is automatically loaded by Docker Compose in development.
# It overrides settings from docker-compose.yml for local development.
#
# Features:
#   - Hot reload with volume mounts
#   - Debug port exposure (9229)
#   - Development-specific settings
#   - Separate volumes to avoid conflicts
#
# Usage:
#   Development: docker compose up (automatically applies this file)
#   To exclude:  docker compose -f docker-compose.yml up
# =============================================================================

version: '3.8'

services:
  # ---------------------------------------------------------------------------
  # MongoDB - Development Overrides
  # ---------------------------------------------------------------------------
  mongodb:
    container_name: reservations-mongodb-dev
    volumes:
      - mongodb_data_dev:/data/db
      - mongodb_config_dev:/data/configdb
    networks:
      - reservations-network-dev

  # ---------------------------------------------------------------------------
  # Reservations Service - Development Overrides
  # ---------------------------------------------------------------------------
  reservations:
    build:
      target: development
      args:
        NODE_ENV: development
    image: reservations-service:dev
    container_name: reservations-service-dev
    ports:
      - '${RESERVATIONS_PORT:-3000}:3000'
      - '${RESERVATIONS_DEBUG_PORT:-9229}:9229' # Node.js debugger port (host:container)
    environment:
      NODE_ENV: development
    volumes:
      # Mount source code for hot reload
      - .:/app
      # Prevent node_modules and dist from being overwritten
      - /app/node_modules
      - /app/dist
    networks:
      - reservations-network-dev
    # Override command to use debug mode - inspect binds to 0.0.0.0:9229 for Docker
    command: pnpm exec nest start reservations --debug 0.0.0.0:9229 --watch

  # ---------------------------------------------------------------------------
  # Auth Service - Development Overrides
  # ---------------------------------------------------------------------------
  auth:
    build:
      target: development
      args:
        NODE_ENV: development
    image: auth-service:dev
    container_name: auth-service-dev
    ports:
      - '${AUTH_PORT:-3001}:3001'
      - '${AUTH_DEBUG_PORT:-9230}:9230' # Node.js debugger port (host:container)
    environment:
      NODE_ENV: development
    volumes:
      # Mount source code for hot reload
      - .:/app
      # Prevent node_modules and dist from being overwritten
      - /app/node_modules
      - /app/dist
    networks:
      - reservations-network-dev
    # Override command to use debug mode - inspect binds to 0.0.0.0:9230 for Docker
    command: pnpm exec nest start auth --debug 0.0.0.0:9230 --watch

# -----------------------------------------------------------------------------
# Development Volumes (separate from production)
# -----------------------------------------------------------------------------
volumes:
  mongodb_data_dev:
    driver: local
    name: reservations_mongodb_data_dev
  mongodb_config_dev:
    driver: local
    name: reservations_mongodb_config_dev

# -----------------------------------------------------------------------------
# Development Network (separate from production)
# -----------------------------------------------------------------------------
networks:
  reservations-network-dev:
    driver: bridge
    name: reservations_network_dev
